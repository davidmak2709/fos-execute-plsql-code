var FOS=window.FOS||{};FOS.exec=FOS.exec||{},FOS.exec.createNestedObjectAndAssign=function(e,t,s){for(var a,i=t.split("."),n=i.length-1,r=0;r<n;++r)(a=i[r])in e||(e[a]={}),e=e[a];e[i[n]]=s},FOS.exec.plsql=function(e,t,s){var a="danger",i="error",n="info",r="success",o="warning";apex.debug.info("FOS - Execute PL/SQL Code",t),s instanceof Function&&s.call(e,t,C);var l,c,u,p,m,f,d,g,b=e.affectedElements,x=e.resumeCallback,h=t.ajaxId,v=t.pageItems,y=t.spinnerSettings,w=t.clobSettings,E=t.options,C={};if(C={dismiss:["onClick","onButton"],dismissAfter:t.fostr.dismissAfter,newestOnTop:!0,preventDuplicates:!1,escapeHtml:!1,position:"top-right",iconClass:null,clearAll:!1},w.submitClob)switch(w.submitClobFrom){case"pageitem":p=apex.item(w.submitClobItem).getValue();break;case"javascriptvariable":var S=w.submitClobVariable.split(".").reduce((function(e,t){return e?.[t]}),window);p=S instanceof Object?JSON.stringify(S):S;break;case"javascriptinit":"function"==typeof t.submitClob?p=t.submitClob.call(t):apex.debug.warn('.... Error "submitClob" function is missing from the config options. You must define this function in the "Javascript Initialization Code" attribute in your dynamic action!')}y.showSpinner&&(y.spinnerElement=y.showSpinnerOnRegion?b:"body",f=y.spinnerElement,d=y.showSpinnerOverlay,g="body"==f,m=function(e){var t,s=apex.util.showSpinner(f,{fixed:g});return d&&(t=$('<div class="fos-region-overlay'+(g?"-fixed":"")+'"></div>').prependTo(f)),function(){t&&t.remove(),s.remove()}}),Promise.resolve(p).then((function(s){apex.server.plugin(h,{pageItems:v.itemsToSubmit,p_clob_01:s},{dataType:"json",loadingIndicator:m,target:e.browserEvent.target}).done((function(e){!function(e){if(e.status==r){var s,p,m=!1;if(m=!!e.cancelActions,e&&e.items){s=(p=e.items).length;for(var f=0;f<s;f++)p[f].display?$s(p[f].id,p[f].value,p[f].display,E.suppressChangeEvent):$s(p[f].id,p[f].value,null,E.suppressChangeEvent)}if(w.returnClob)switch(w.returnClobInto){case"pageitem":$s(w.returnClobItem,e.clob,null,E.suppressChangeEvent);break;case"javascriptvariable":FOS.exec.createNestedObjectAndAssign(window,w.returnClobVariable,e.clob);break;case"javascriptvariablejson":e.execPlsqlResult=JSON.parse(e.clob),FOS.exec.createNestedObjectAndAssign(window,w.returnClobVariable,e.execPlsqlResult),function(e){var t={hideRegions:function(e){try{apex.region(e).element.hide()}catch(t){apex.debug.warn(".... Error hiding the following region: "+e,t)}},showRegions:function(e){try{apex.region(e).element.show()}catch(t){apex.debug.warn(".... Error showing the following region: "+e,t)}},hideItems:function(e){apex.item(e).hide()},showItems:function(e){apex.item(e).show()},enableItems:function(e){apex.item(e).enable()},disableItems:function(e){apex.item(e).disable()},hideButtons:function(e){apex.jQuery("#"+e).hide()},showButtons:function(e){apex.jQuery("#"+e).show()},enableButtons:function(e){apex.jQuery("#"+e).attr("disabled",!1)},disableButtons:function(e){apex.jQuery("#"+e).attr("disabled",!0)},setValues:function(e){$s(e.name,e.value,e.display,e.suppressChangeEvent)},clearErrors:function(){apex.message.clearErrors()},itemErrors:function(e){var t=apex.util.applyTemplate(e.message,{defaultEscapeFilter:null});apex.message.showErrors({type:i,location:e.location||["inline","page"],pageItem:e.name,message:t,unsafe:!1})},refreshRegions:function(e){try{apex.region(e).refresh()}catch(t){apex.debug.warn(".... Error refreshing the following region: "+e,t)}},refreshItems:function(e){try{apex.item(e).refresh()}catch(t){apex.debug.warn(".... Error refreshing the following item: "+e,t)}},fireEvents:function(e){apex.event.trigger(e.selector||"body",e.name,e.data)},removeClass:function(e){apex.jQuery(e.selector).removeClass(e.class)},addClass:function(e){apex.jQuery(e.selector).addClass(e.class)}};if(Object.entries(t).forEach((function(t){var s=t[0],a=t[1];s in e&&Array.isArray(e[s])?e[s].forEach(a):s in e&&["boolean","number","string"].includes(typeof e[s])&&a.call(e,e[s])})),e.setFocusItem)try{apex.item(e.setFocusItem).setFocus()}catch(t){apex.debug.warn(".... Error setting focus the following item: "+e.setFocusItem,t)}}(e.execPlsqlResult);break;case"javascriptinitasjson":"function"==typeof t.clobCallback?(e.execPlsqlResult=JSON.parse(e.clob),t.clobCallback.call(t,e.execPlsqlResult)):apex.debug.warn('.... Error "clobCallback" function is missing from the config options. You must define this function in the "Javascript Initialization Code" attribute in your dynamic action!')}if(e.execPlsqlResult&&(e.execPlsqlResult.cancelActions&&(m=!0),e.execPlsqlResult.notification)){var d=e.execPlsqlResult.notification;e.message=d.message,e.messageType=d.type,e.messageTitle=d.title}e.message&&(c=(c=e.messageType&&[n,o,r,i,a].includes(e.messageType)?e.messageType:r)===a?i:c,u=e.messageTitle,l=e.message,u&&E.performSubstitutions&&(u=apex.util.applyTemplate(u,{defaultEscapeFilter:null})),l&&E.performSubstitutions&&(l=apex.util.applyTemplate(l,{defaultEscapeFilter:null})),u&&E.escapeMessage&&(u=apex.util.escapeHTML(u)),l&&E.escapeMessage&&(l=apex.util.escapeHTML(l)),$.extend(C,{message:l,title:u,type:c,dismissAfter:c===i?void 0:C.dismissAfter}),fostr[c](C)),e.eventName&&apex.event.trigger("body",e.eventName,e),apex.da.resume(x,m)}else e.status==i&&(e.message&&(u=e.messageTitle,l=e.message,u&&E.performSubstitutions&&(u=apex.util.applyTemplate(u,{defaultEscapeFilter:null})),l&&E.performSubstitutions&&(l=apex.util.applyTemplate(l,{defaultEscapeFilter:null})),u&&E.escapeMessage&&(u=apex.util.escapeHTML(u)),l&&E.escapeMessage&&(l=apex.util.escapeHTML(l)),E.showErrorAsAlert?apex.message.alert(l):($.extend(C,{message:l,title:u,type:i,dismissAfter:void 0}),fostr.error(C),e.eventName&&apex.event.trigger("body",e.eventName,e))),apex.da.resume(x,!0))}(e)})).fail((function(e,t,s){apex.da.handleAjaxErrors(e,t,s,x)}))})).catch((function(e){apex.debug("##ERROR## FOS.Execute.PLSQL",e),apex.da.handleAjaxErrors({status:999},"FOS.Execute.PLSQL",e,x)}))};